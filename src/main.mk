include $(CBE)/src/lib/tools.mk
include $(CBE)/src/lib/verbosity.mk

# For verbosity on top level makes
DISPLAYNAME=""
TMPDIR=build/tmp/root

################################################################################
# All
################################################################################

all: $(addprefix build/,$(TARGETS))

################################################################################
# Top level dependencies
################################################################################

-include $(patsubst %,build/deps/%.d,$(TARGETS))

build/deps/%.d: make/%.mk
	$(Q)$(MAKE) $(SILENT) -f $(CBE)/src/dep.mk $@

################################################################################
# Build target
################################################################################

TARGET_FILES=$(addprefix build/,$(TARGETS))
$(TARGET_FILES): FORCE
	$(call TRACE,MAKE)
	$(Q)$(MAKE) $(SILENT) -f $(CBE)/src/target.mk $@

################################################################################
# Clean
################################################################################

clean: FORCE
	rm -rf build

################################################################################
# Meta
################################################################################

FORCE:
.PHONY: FORCE
